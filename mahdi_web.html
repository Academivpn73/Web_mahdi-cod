<!DOCTYPE html><html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>سایت تولید فلوچارت هوشمند</title>
<style>
 body { font-family: Vazirmatn, sans-serif; background:#f1f1f1; margin:0; padding:0; }
 .box { background:white; padding:20px; border-radius:15px; max-width:900px; margin:20px auto;
        box-shadow:0 4px 20px rgba(0,0,0,0.12); }
 textarea { width:100%; padding:14px; border-radius:10px; font-size:17px; border:1px solid #bbb; }
 pre { padding:15px; background:#fafafa; border-radius:10px; white-space:pre-wrap; font-size:15px; }
 button { background:#0066ff; color:white; padding:12px 22px; border:none;
          border-radius:10px; font-size:18px; cursor:pointer; margin-top:10px; width:100%; }
 #flowchartImg { margin-top:15px; width:100%; border:1px solid #aaa; border-radius:10px; }
 .downloadBtn { background:#28a745; }@media print { body * { visibility: hidden; } #printArea, #printArea * { visibility: visible; } #printArea { position:absolute; top:0; left:0; width:100%; } } </style>

</head>
<body>
<div class="box">
 <h2>سایت هوشمند تولید فلوچارت (مخصوص موبایل و سیستم)</h2><label>مسئله را وارد کنید:</label>

 <textarea id="problem" rows="6" placeholder="متن مسئله را اینجا وارد کنید..."></textarea><button onclick="generate()">تولید خروجی</button>

 <div id="printArea">
 <h3>الگوریتم:</h3>
 <pre id="algorithm"></pre> <h3>فلوچارت (متنی):</h3>
 <pre id="flowchartText"></pre> <h3>فلوچارت گرافیکی:</h3>
 <img id="flowchartImg">
 </div><button class="downloadBtn" onclick="downloadImg()">دانلود تصویر</button> <button onclick="window.print()">چاپ</button>

 <h3>پایگاه داده پیشنهادی:</h3>
 <pre id="database"></pre>
</div><script>
// تحلیل دقیق‌تر مسئله
function analyze(problem) {
 let steps = [];

 if (/سن|سال/.test(problem)) steps.push({ type:"input", text:"دریافت سن" });
 if (/بین|از/.test(problem) && /تا/.test(problem)) steps.push({ type:"decision", text:"چک کردن بازه سنی" });
 if (/mod|مد|زوج|بر دو|2/.test(problem)) {
     steps.push({ type:"process", text:"محاسبه mod برای تعیین زوج یا فرد" });
     steps.push({ type:"decision", text:"آیا عدد زوج است؟" });
 }
 if (/ورود|اجازه|مسابقه/.test(problem)) steps.push({ type:"output", text:"اجازه ورود یا عدم ورود" });

 steps.push({ type:"end", text:"پایان" });
 return steps;
}

// رسم حرفه‌ای فلوچارت
function drawFlowchart(steps) {
 const canvas = document.createElement("canvas");
 canvas.width = 1000;
 canvas.height = steps.length * 190;
 const ctx = canvas.getContext("2d");
 ctx.font = "20px Vazirmatn";
 ctx.textAlign = "center";
 let y = 90;

 steps.forEach((s, i) => {
   ctx.beginPath();

   if (s.type === "input" || s.type === "output" || s.type === "process") {
       ctx.rect(280, y-40, 440, 80);
   } else if (s.type === "decision") {
       ctx.moveTo(500, y-70);
       ctx.lineTo(600, y);
       ctx.lineTo(500, y+70);
       ctx.lineTo(400, y);
       ctx.closePath();
   } else if (s.type === "end") {
       ctx.ellipse(500, y, 180, 50, 0, 0, Math.PI * 2);
   }

   ctx.stroke();
   wrap(ctx, s.text, 500, y, 380, 22);

   if (i < steps.length - 1) {
       ctx.beginPath();
       ctx.moveTo(500, y+80);
       ctx.lineTo(500, y+130);
       ctx.stroke();
       ctx.beginPath();
       ctx.moveTo(495, y+130);
       ctx.lineTo(505, y+130);
       ctx.lineTo(500, y+145);
       ctx.fill();
   }

   y += 170;
 });

 return canvas.toDataURL();
}

// شکست متن داخل شکل‌ها
function wrap(ctx, text, x, y, maxWidth, lh) {
 const words = text.split(" ");
 let line = "";
 let yy = y - lh;
 for (let w of words) {
     let test = line + w + " ";
     if (ctx.measureText(test).width > maxWidth) {
         ctx.fillText(line, x, yy);
         line = w + " ";
         yy += lh;
     } else line = test;
 }
 ctx.fillText(line, x, yy);
}

function generate() {
 const problem = document.getElementById("problem").value.trim();
 if (!problem) return alert("لطفاً مسئله را وارد کنید");

 const steps = analyze(problem);

 // ساخت الگوریتم متنی
 let algo = "1. شروع
";
 steps.forEach((s, i) => { algo += (i + 2) + ". " + s.text + "
"; });
 document.getElementById("algorithm").innerText = algo;

 // فلوچارت متنی
 document.getElementById("flowchartText").innerText = steps.map(s => `[${s.text}]`).join("
↓
");

 // رسم و نمایش تصویر
 document.getElementById("flowchartImg").src = drawFlowchart(steps);

 // دیتابیس
 document.getElementById("database").innerText = `TABLE Problems (
 id INT PRIMARY KEY,
 problem_text TEXT,
 algorithm TEXT,
 flowchart_image BLOB,
 steps_json JSON
);`;
}

function downloadImg() {
 const img = document.getElementById("flowchartImg").src;
 if (!img) return alert("ابتدا فلوچارت را تولید کنید");
 const a = document.createElement("a");
 a.href = img;
 a.download = "flowchart.png";
 a.click();
}
</script></body>
</html>
