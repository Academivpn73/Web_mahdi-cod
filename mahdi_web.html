<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>فلوچارت هوشمند عمومی</title>
<style>
:root{
  --bg:#041522; --card:#062032; --muted:#98a8bd;
  --start:#16a34a; --proc:#0284c7; --dec:#f97316; --end:#7c3aed; --arrow:#9fd6f7;
  --text:#e6eef8;
}
body{margin:0;padding:20px;font-family:Vazirmatn,sans-serif;background:var(--bg);color:var(--text);}
.card{background:var(--card);padding:16px;border-radius:12px;margin-bottom:16px;box-shadow:0 6px 20px rgba(0,0,0,0.5);}
textarea{width:100%;min-height:100px;padding:10px;background:transparent;border:1px solid rgba(255,255,255,0.1);color:inherit;border-radius:8px;}
button{padding:10px 14px;border:none;border-radius:10px;background:var(--proc);color:white;cursor:pointer;margin-top:6px;margin-right:4px;}
.layout{display:grid;grid-template-columns:1fr 440px;gap:16px;}
.flowcard{height:640px;overflow:auto;padding:12px;}
pre{white-space:pre-wrap;word-break:break-word;color:#cfe9ff;}
.legend{display:flex;flex-direction:column;gap:6px;font-size:13px;margin-top:10px;}
.item{display:flex;gap:8px;align-items:center;}
.dot{width:18px;height:18px;border-radius:4px;}
.dot.round{border-radius:50%;}
.muted{color:var(--muted);font-size:13px;}
svg{width:100%;height:100%;display:block;}
@media(max-width:1100px){.layout{grid-template-columns:1fr;}}
</style>
</head>
<body>

<div class="card">
<h2>فلوچارت هوشمند عمومی</h2>
<p>هر مسئله‌ای که می‌خواهید را وارد کنید، فلوچارت اختصاصی تولید می‌شود.</p>
<textarea id="problem" placeholder="مثال: اعداد بین 10 تا 30 را تولید کن"></textarea>
<br>
<button id="generate">تولید فلوچارت</button>
<button id="exportSvg">دانلود SVG</button>
<button id="exportPng">دانلود PNG</button>
</div>

<div class="layout">
<div class="card flowcard">
<div class="badge">فلوچارت (SVG)</div>
<div id="svgWrap" style="margin-top:12px;height:640px;">
<svg id="flowSvg" viewBox="0 0 900 1200" preserveAspectRatio="xMidYMin meet"></svg>
</div>
<div class="legend">
<div style="font-weight:600">راهنما شکل‌ها</div>
<div class="item"><div class="dot round" style="background:var(--start)"></div> دایره: شروع / پایان</div>
<div class="item"><div class="dot" style="background:var(--proc)"></div> مستطیل: عملیات / محاسبات</div>
<div class="item"><div class="dot" style="background:var(--dec);width:22px;height:22px;transform:rotate(45deg)"></div> لوزی: شرط / تصمیم</div>
<div class="item"><div class="dot" style="background:var(--end)"></div> خروجی / نمایش نتیجه</div>
<div class="item muted">فلش‌ها مسیر اجرا را نشان می‌دهند.</div>
</div>
</div>

<div class="card flowcard">
<div class="badge">اطلاعات کد</div>
<div id="info" style="margin-top:12px;color:#cfe9ff"></div>
<hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.04)">
<div class="badge">شرح هر گره</div>
<pre id="explain"></pre>
</div>
</div>

<script>
/* ====== تحلیل generic ====== */
function analyzeGeneric(text){
  return {type:'generic', features:[]};
}

/* ====== ساخت گراف عمومی ====== */
function buildGenericGraph(text){
  const nodes=[], edges=[], nid = (i=>()=> 'n'+(i+=1))(0);
  const start = nid(); nodes.push({id:start,text:'شروع',type:'start'});
  const input = nid(); nodes.push({id:input,text:'دریافت ورودی‌ها (براساس مسئله)','type':'proc'});
  const process = nid(); nodes.push({id:process,text:'پردازش اصلی مسئله','type':'proc'});
  const decision = nid(); nodes.push({id:decision,text:'شرط / تکرار؟','type':'decision'});
  const loop = nid(); nodes.push({id:loop,text:'عملیات تکراری / مرحله‌ای','type':'proc'});
  const output = nid(); nodes.push({id:output,text:'نمایش نتیجه / خروجی','type':'end'});
  edges.push({from:start,to:input,label:''});
  edges.push({from:input,to:process,label:''});
  edges.push({from:process,to:decision,label:''});
  edges.push({from:decision,to:loop,label:'بله'});
  edges.push({from:loop,to:decision,label:''});
  edges.push({from:decision,to:output,label:'خیر'});
  return {nodes,edges,start,output};
}

/* ====== layout عمودی ====== */
function layoutGraph(graph){
  const positions={}; let y=60;
  graph.nodes.forEach((n,idx)=>{
    let x=450;
    if(n.type==='decision') x = idx%2===0? 310 : 590;
    positions[n.id]={x,y}; y+=110;
  });
  return positions;
}

/* ====== render SVG ====== */
function render(graph, positions, svgEl){
  while(svgEl.firstChild) svgEl.removeChild(svgEl);
  const ns='http://www.w3.org/2000/svg';
  const el=(t,a={})=>{const e=document.createElementNS(ns,t);for(const k in a)e.setAttribute(k,a[k]);return e;}
  const defs=el('defs'); svgEl.appendChild(defs);
  const marker=el('marker',{id:'arrow', markerWidth:10, markerHeight:10, refX:8, refY:5, orient:'auto', markerUnits:'strokeWidth'});
  marker.appendChild(el('path',{d:'M0 0 L10 5 L0 10 z',fill:'var(--arrow)'})); defs.appendChild(marker);
  graph.edges.forEach(e=>{
    const p1=positions[e.from], p2=positions[e.to];
    const startX=p1.x,startY=p1.y+30,endX=p2.x,endY=p2.y-30,midY=(startY+endY)/2;
    const pathD=`M ${startX} ${startY} C ${startX} ${midY} ${endX} ${midY} ${endX} ${endY}`;
    const pathEl=el('path',{d:pathD,stroke:'var(--arrow)','stroke-width':1.6,fill:'none','marker-end':'url(#arrow)'}); svgEl.appendChild(pathEl);
    if(e.label){const tEl=el('text',{x:(startX+endX)/2,y:midY-8,'text-anchor':'middle',class:'label-text'}); tEl.textContent=e.label; svgEl.appendChild(tEl);}
  });
  graph.nodes.forEach(n=>{
    const p=positions[n.id]; const g=el('g',{'data-id':n.id});
    if(n.type==='start'){g.appendChild(el('rect',{x:p.x-110,y:p.y-22,width:220,height:44,rx:22,fill:'var(--start)'}));}
    else if(n.type==='end'){g.appendChild(el('rect',{x:p.x-110,y:p.y-22,width:220,height:44,rx:22,fill:'var(--end)'}));}
    else if(n.type==='decision'){const sX=110,sY=34;const pts=`${p.x},${p.y-sY} ${p.x+sX},${p.y} ${p.x},${p.y+sY} ${p.x-sX},${p.y}`;g.appendChild(el('polygon',{points:pts,fill:'var(--dec)'}));}
    else{g.appendChild(el('rect',{x:p.x-140,y:p.y-24,width:280,height:48,rx:8,fill:'var(--proc)'}));}
    const lines=n.text.match(/.{1,28}/g)||[n.text]; lines.forEach((ln,i)=>{const tx=el('text',{x:p.x,y:p.y-((lines.length-1)*8)+i*16,'text-anchor':'middle','class':'node-text'});tx.textContent=ln; g.appendChild(tx);});
    svgEl.appendChild(g);
  });
}

/* ====== توضیح گره ====== */
function explainNodeText(nodeText){
  return 'این مرحله مربوط به: '+nodeText;
}

/* ====== تولید info ====== */
function genInfo(graph){
  return {inputs:['ورودی‌ها براساس متن'], variables:['متغیرهای کمکی (i,j,...)'], complexity:'پیچیدگی تقریبی خطی یا حلقه‌ای'};
}

/* ====== UI ====== */
const genBtn=document.getElementById('generate'), problemEl=document.getElementById('problem'),
svgEl=document.getElementById('flowSvg'), infoEl=document.getElementById('info'), explainEl=document.getElementById('explain');

genBtn.addEventListener('click',()=>{
  const text=problemEl.value.trim(); if(!text){alert('لطفاً مسئله را وارد کنید'); return;}
  const graph=buildGenericGraph(text); const pos=layoutGraph(graph); render(graph,pos,svgEl);
  const info=genInfo(graph);
  infoEl.innerHTML=`<strong>ورودی‌ها:</strong> ${info.inputs.join(', ')}<br>
  <strong>متغیرها:</strong> ${info.variables.join(', ')}<br>
  <strong>پیچیدگی:</strong> ${info.complexity}`;
  const expl=graph.nodes.map(n=>`- [${n.id}] "${n.text}"\n  توضیح: ${explainNodeText(n.text)}`).join('\n\n');
  explainEl.textContent=expl;
});

/* ====== Export SVG/PNG ====== */
document.getElementById('exportSvg').addEventListener('click',()=>{
  const serializer=new XMLSerializer(); const str=serializer.serializeToString(svgEl);
  const blob=new Blob([str],{type:'image/svg+xml'}); const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='flowchart.svg'; document.body.appendChild(a);a.click();a.remove();
});
document.getElementById('exportPng').addEventListener('click',()=>{
  const serializer=new XMLSerializer(); const str=serializer.serializeToString(svgEl); const img=new Image();
  const svgBlob=new Blob([str],{type:'image/svg+xml'}); const url=URL.createObjectURL(svgBlob);
  img.onload=function(){const canvas=document.createElement('canvas');canvas.width=900;canvas.height=1200;
  const ctx=canvas.getContext('2d'); ctx.fillStyle='#02121a'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.drawImage(img,0,0,canvas.width,canvas.height);
  canvas.toBlob(function(blob){const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='flowchart.png';document.body.appendChild(a);a.click();a.remove();},'image/png'); URL.revokeObjectURL(url);};
  img.src=url;
});
</script>

</body>
</html>
